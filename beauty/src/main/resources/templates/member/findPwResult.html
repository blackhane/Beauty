<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<meta charset="UTF-8">
<title>Beauty</title>
<!-- 제이쿼리 -->
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- swiper -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
<!-- font -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">

<link rel="stylesheet" th:href="@{/css/headfoot.css}">
<link rel="stylesheet" th:href="@{/css/index.css}">
<link rel="stylesheet" th:href="@{/css/member/findPwResult.css}">
<script th:src="@{/js/main.js}"></script>
<th:block th:replace="~{/_header :: headerFragment}"></th:block>
</head>
<script>
	let regPass  = /^.*(?=^.{8,12}$)(?=.*\d)(?=.*[a-zA-Z])(?=.*[!@#$%^&+=]).*$/;

	$(function(){
		$('.changePw').click(function(e){
			e.preventDefault();
			
			let uid = $('.uid').text();
			let pass1 = $('input[name=pass1]').val();
			let pass2 = $('input[name=pass2]').val();
			
			console.log("hr1"+pass1);
			console.log("hr2"+pass2);
			
			if(pass1 != pass2){
				alert('비밀번호가 일치하지 않습니다.\n다시 입력해주세요.');
				return;
			}
			console.log("hr3");
			
			if(!pass2.match(regPass)){
				alert('영문, 숫자, 특수문자 조합하여 8~12자이어야 합니다.');
				return;
			}
			
			let jsonData = {
					"uid": uid,
					"pass": pass2
			};
			console.log("hr4");
			
			$.ajax({
				url: '/beautyshop/member/findPwResult',
				type: 'post',
				data: jsonData,
				dataType: 'json',
				success: function(data){
					console.log("hr5")
					
					if(data.result > 0){
						console.log("hr6")
						alert('비밀번호가 변경되었습니다.\n다시 로그인 하십시오.');
						location.href="/Beauty/member/login";
					}
				}
			});
		});
	});
</script>
<body>
	<main>
		<div class="findPw">
			<h2>비밀번호 찾기 결과</h2>

			<form action="#" method="POST">
				<div class="findPw">
					<fieldset>
						<table border="0">
							<tr>
								<td class="uid">고객님의 아이디는 [[${uid}]] 입니다.</td>
							</tr>
							<tr>
								<td>새 비밀번호</td>
								<td><input type="password" id="pass1" name="pass1" placeholder="새 비밀번호 입력" required="required"/></td>
							</tr>
							<tr>
								<td>새 비밀번호 확인</td>
								<td><input type="password" id="pass2" name="pass2" placeholder="새 비밀번호 입력" required="required"/></td>
							</tr>
							<tr>
								
							</tr>
						</table>
						<div class="btn">
							<a th:href="@{/member/find}" class="changePw">비밀번호 변경</a>
							<a th:href="@{/member/login}" class="btnLogin">로그인</a>
							<a th:href="@{/member/find}" class="findId">아이디 찾기</a>
						</div>	
					</fieldset>
				</div>
			</form>
		</div>
	</main>
	<th:block th:replace="~{/_footer :: footerFragment}"></th:block>
</body>
</html>